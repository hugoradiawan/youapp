/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./apps/user/src/constants/zodiac-end-init.constant.ts":
/*!*************************************************************!*\
  !*** ./apps/user/src/constants/zodiac-end-init.constant.ts ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.zodiacEndList = void 0;
exports.zodiacEndList = [
    '2024-02-9',
    '2023-01-21',
    '2022-01-31',
    '2021-02-11',
    '2020-01-24',
    '2019-02-4',
    '2018-02-15',
    '2017-01-27',
    '2016-02-7',
    '2015-02-18',
    '2014-01-30',
    '2013-02-9',
    '2012-01-22',
    '2011-02-2',
    '2010-02-13',
    '2009-01-25',
    '2008-02-6',
    '2007-02-17',
    '2006-01-28',
    '2005-02-8',
    '2004-01-21',
    '2003-01-31',
    '2002-02-11',
    '2001-01-23',
    '2000-02-4',
    '1999-02-15',
    '1998-01-27',
    '1997-02-6',
    '1996-02-18',
    '1995-01-30',
    '1994-02-9',
    '1993-01-22',
    '1992-02-3',
    '1991-02-14',
    '1990-01-26',
    '1989-02-5',
    '1988-02-16',
    '1987-01-28',
    '1986-02-8',
    '1985-02-19',
    '1984-02-1',
    '1983-02-12',
    '1982-01-24',
    '1981-02-4',
    '1980-02-15',
    '1979-01-27',
    '1978-02-6',
    '1977-02-17',
    '1976-01-30',
    '1975-02-10',
    '1974-01-22',
    '1973-02-2',
    '1972-01-15',
    '1971-01-26',
    '1970-02-5',
    '1969-02-16',
    '1968-01-29',
    '1967-02-8',
    '1966-01-20',
    '1965-02-1',
    '1964-02-12',
    '1963-01-24',
    '1962-02-4',
    '1961-02-14',
    '1960-01-27',
    '1959-02-7',
    '1958-02-17',
    '1957-01-30',
    '1956-02-11',
    '1955-01-23',
    '1954-02-2',
    '1953-02-13',
    '1952-01-26',
    '1951-02-5',
    '1950-02-16',
    '1949-01-28',
    '1948-02-9',
    '1947-01-21',
    '1946-02-1',
    '1945-02-12',
    '1944-01-24',
    '1943-02-4',
    '1942-02-14',
    '1941-01-26',
    '1940-02-7',
    '1939-02-18',
    '1938-01-30',
    '1937-02-10',
    '1936-01-23',
    '1935-02-3',
    '1934-02-13',
    '1933-01-25',
    '1932-02-5',
    '1931-02-16',
    '1930-01-29',
    '1929-02-9',
    '1928-01-22',
    '1927-02-1',
    '1926-02-12',
    '1925-01-24',
    '1924-02-4',
    '1923-02-15',
    '1922-01-27',
    '1921-02-7',
    '1920-02-19',
    '1919-01-31',
    '1918-02-10',
    '1917-01-22',
    '1916-02-2',
    '1915-02-13',
    '1914-01-25',
    '1913-02-5',
];


/***/ }),

/***/ "./apps/user/src/enums/horoscope.enum.ts":
/*!***********************************************!*\
  !*** ./apps/user/src/enums/horoscope.enum.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.HOROSCOPE_START_DATES = exports.HOROSCOPE = void 0;
exports.HOROSCOPE = {
    Aries: 'Aries',
    Taurus: 'Taurus',
    Gemini: 'Gemini',
    Cancer: 'Cancer',
    Leo: 'Leo',
    Virgo: 'Virgo',
    Libra: 'Libra',
    Scorpio: 'Scorpio',
    Sagittarius: 'Sagittarius',
    Capricorn: 'Capricorn',
    Aquarius: 'Aquarius',
    Pisces: 'Pisces',
};
exports.HOROSCOPE_START_DATES = {
    120: exports.HOROSCOPE.Aquarius,
    219: exports.HOROSCOPE.Pisces,
    321: exports.HOROSCOPE.Aries,
    420: exports.HOROSCOPE.Taurus,
    521: exports.HOROSCOPE.Gemini,
    621: exports.HOROSCOPE.Cancer,
    723: exports.HOROSCOPE.Leo,
    823: exports.HOROSCOPE.Virgo,
    923: exports.HOROSCOPE.Libra,
    1023: exports.HOROSCOPE.Scorpio,
    1122: exports.HOROSCOPE.Sagittarius,
    1222: exports.HOROSCOPE.Capricorn,
    1232: exports.HOROSCOPE.Aquarius,
};


/***/ }),

/***/ "./apps/user/src/enums/zodiac.enum.ts":
/*!********************************************!*\
  !*** ./apps/user/src/enums/zodiac.enum.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.zodiacList = exports.ZODIAC = void 0;
exports.ZODIAC = {
    Rabbit: 'Rabbit',
    Tiger: 'Tiger',
    Ox: 'Ox',
    Rat: 'Rat',
    Pig: 'Pig',
    Dog: 'Dog',
    Rooster: 'Rooster',
    Monkey: 'Monkey',
    Goat: 'Goat',
    Horse: 'Horse',
    Snake: 'Snake',
    Dragon: 'Dragon',
};
exports.zodiacList = [
    exports.ZODIAC.Boar,
    exports.ZODIAC.Rat,
    exports.ZODIAC.Ox,
    exports.ZODIAC.Tiger,
    exports.ZODIAC.Rabbit,
    exports.ZODIAC.Dragon,
    exports.ZODIAC.Snake,
    exports.ZODIAC.Horse,
    exports.ZODIAC.Goat,
    exports.ZODIAC.Monkey,
    exports.ZODIAC.Rooster,
    exports.ZODIAC.Dog,
];


/***/ }),

/***/ "./apps/user/src/schemas/profile.schema.ts":
/*!*************************************************!*\
  !*** ./apps/user/src/schemas/profile.schema.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ProfileSchema = void 0;
const mongoose_1 = __webpack_require__(/*! mongoose */ "mongoose");
exports.ProfileSchema = new mongoose_1.Schema({
    userId: String,
    name: String,
    birthday: String,
    gender: Boolean,
    heightInCm: Number,
    weightInKg: Number,
    horoscope: String,
    zodiac: String,
    interests: [String],
});


/***/ }),

/***/ "./apps/user/src/schemas/user.schema.ts":
/*!**********************************************!*\
  !*** ./apps/user/src/schemas/user.schema.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserSchema = void 0;
const mongoose_1 = __webpack_require__(/*! mongoose */ "mongoose");
exports.UserSchema = new mongoose_1.default.Schema({
    email: String,
    username: String,
    password: String,
});


/***/ }),

/***/ "./apps/user/src/schemas/zodiac.schema.ts":
/*!************************************************!*\
  !*** ./apps/user/src/schemas/zodiac.schema.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ZodiacEnd = void 0;
const mongoose_1 = __webpack_require__(/*! mongoose */ "mongoose");
exports.ZodiacEnd = new mongoose_1.Schema({
    data: [String],
});


/***/ }),

/***/ "./apps/user/src/user.controller.ts":
/*!******************************************!*\
  !*** ./apps/user/src/user.controller.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserController = void 0;
const common_1 = __webpack_require__(/*! @nestjs/common */ "@nestjs/common");
const user_service_1 = __webpack_require__(/*! ./user.service */ "./apps/user/src/user.service.ts");
const microservices_1 = __webpack_require__(/*! @nestjs/microservices */ "@nestjs/microservices");
const shared_1 = __webpack_require__(/*! @app/shared */ "./libs/shared/src/index.ts");
let UserController = class UserController {
    constructor(userService, sharedService) {
        this.userService = userService;
        this.sharedService = sharedService;
    }
    async register(context) {
        const extractData = this.sharedService.extractData(context);
        try {
            const result = await this.userService.findOneByEmailOrByUsername(extractData.data);
            extractData.ack();
            return result;
        }
        catch (error) {
            console.log(error);
            extractData.nack();
            return null;
        }
    }
    async createUser(context) {
        const extractData = this.sharedService.extractData(context);
        try {
            const result = await this.userService.create(extractData.data);
            extractData.ack();
            return result;
        }
        catch (error) {
            console.log(error);
            extractData.nack();
            return null;
        }
    }
    async getProfileAndUser(context) {
        const extractData = this.sharedService.extractData(context);
        try {
            const result = await this.userService.getProfileAndUser(extractData.data);
            extractData.ack();
            return result;
        }
        catch (error) {
            console.log(error);
            extractData.nack();
            return null;
        }
    }
    async getHoroscopeZodiac(context) {
        const extractData = this.sharedService.extractData(context);
        try {
            const result = await this.userService.getHoroscopeZodiac(extractData.data);
            extractData.ack();
            return result;
        }
        catch (error) {
            console.log(error);
            extractData.nack();
            return null;
        }
    }
    async updateProfile(context) {
        const extractData = this.sharedService.extractData(context);
        const toUpdate = { ...extractData.data };
        delete toUpdate.userId;
        try {
            const result = await this.userService.updateProfile(extractData.data.userId, toUpdate);
            extractData.ack();
            return result;
        }
        catch (error) {
            console.log(error);
            extractData.nack();
            return false;
        }
    }
    async getAllProfile(context) {
        const extractData = this.sharedService.extractData(context);
        try {
            const result = await this.userService.findAllProfile(extractData.data);
            extractData.ack();
            return result;
        }
        catch (error) {
            console.log(error);
            extractData.nack();
            return [];
        }
    }
    async getProfiles(context) {
        const extractData = this.sharedService.extractData(context);
        try {
            const result = await this.userService.getProfileNames(extractData.data);
            extractData.ack();
            return result;
        }
        catch (error) {
            console.log(error);
            extractData.nack();
            return [];
        }
    }
    async updatePassword(context) {
        const extractData = this.sharedService.extractData(context);
        try {
            const result = await this.userService.updatePassword(extractData.data);
            extractData.ack();
            return result;
        }
        catch (error) {
            console.log(error);
            extractData.nack();
            return false;
        }
    }
    async isUserIdExist(context) {
        const extractData = this.sharedService.extractData(context);
        try {
            const result = await this.userService.isUserIdExist(extractData.data);
            extractData.ack();
            return result;
        }
        catch (error) {
            console.log(error);
            extractData.nack();
            return false;
        }
    }
    async isUsernameExist(context) {
        const extractData = this.sharedService.extractData(context);
        try {
            const result = await this.userService.isUsernameExist(extractData.data);
            extractData.ack();
            return result;
        }
        catch (error) {
            console.log(error);
            extractData.nack();
            return false;
        }
    }
};
exports.UserController = UserController;
__decorate([
    (0, microservices_1.MessagePattern)('find-user-by-email-or-username'),
    __param(0, (0, microservices_1.Ctx)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_c = typeof microservices_1.RmqContext !== "undefined" && microservices_1.RmqContext) === "function" ? _c : Object]),
    __metadata("design:returntype", typeof (_d = typeof Promise !== "undefined" && Promise) === "function" ? _d : Object)
], UserController.prototype, "register", null);
__decorate([
    (0, microservices_1.MessagePattern)('create-user'),
    __param(0, (0, microservices_1.Ctx)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_e = typeof microservices_1.RmqContext !== "undefined" && microservices_1.RmqContext) === "function" ? _e : Object]),
    __metadata("design:returntype", Promise)
], UserController.prototype, "createUser", null);
__decorate([
    (0, microservices_1.MessagePattern)('get-profile-and-user'),
    __param(0, (0, microservices_1.Ctx)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_f = typeof microservices_1.RmqContext !== "undefined" && microservices_1.RmqContext) === "function" ? _f : Object]),
    __metadata("design:returntype", typeof (_g = typeof Promise !== "undefined" && Promise) === "function" ? _g : Object)
], UserController.prototype, "getProfileAndUser", null);
__decorate([
    (0, microservices_1.MessagePattern)('get-horoscope-zodiac'),
    __param(0, (0, microservices_1.Ctx)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_h = typeof microservices_1.RmqContext !== "undefined" && microservices_1.RmqContext) === "function" ? _h : Object]),
    __metadata("design:returntype", typeof (_j = typeof Promise !== "undefined" && Promise) === "function" ? _j : Object)
], UserController.prototype, "getHoroscopeZodiac", null);
__decorate([
    (0, microservices_1.MessagePattern)('update-profile'),
    __param(0, (0, microservices_1.Ctx)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_k = typeof microservices_1.RmqContext !== "undefined" && microservices_1.RmqContext) === "function" ? _k : Object]),
    __metadata("design:returntype", Promise)
], UserController.prototype, "updateProfile", null);
__decorate([
    (0, microservices_1.MessagePattern)('get-all-profiles'),
    __param(0, (0, microservices_1.Ctx)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_l = typeof microservices_1.RmqContext !== "undefined" && microservices_1.RmqContext) === "function" ? _l : Object]),
    __metadata("design:returntype", Promise)
], UserController.prototype, "getAllProfile", null);
__decorate([
    (0, microservices_1.MessagePattern)('get-profile-names'),
    __param(0, (0, microservices_1.Ctx)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_m = typeof microservices_1.RmqContext !== "undefined" && microservices_1.RmqContext) === "function" ? _m : Object]),
    __metadata("design:returntype", typeof (_o = typeof Promise !== "undefined" && Promise) === "function" ? _o : Object)
], UserController.prototype, "getProfiles", null);
__decorate([
    (0, microservices_1.MessagePattern)('update-password'),
    __param(0, (0, microservices_1.Ctx)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_p = typeof microservices_1.RmqContext !== "undefined" && microservices_1.RmqContext) === "function" ? _p : Object]),
    __metadata("design:returntype", Promise)
], UserController.prototype, "updatePassword", null);
__decorate([
    (0, microservices_1.MessagePattern)('is-userid-exist'),
    __param(0, (0, microservices_1.Ctx)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_q = typeof microservices_1.RmqContext !== "undefined" && microservices_1.RmqContext) === "function" ? _q : Object]),
    __metadata("design:returntype", Promise)
], UserController.prototype, "isUserIdExist", null);
__decorate([
    (0, microservices_1.MessagePattern)('is-username-exist'),
    __param(0, (0, microservices_1.Ctx)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [typeof (_r = typeof microservices_1.RmqContext !== "undefined" && microservices_1.RmqContext) === "function" ? _r : Object]),
    __metadata("design:returntype", Promise)
], UserController.prototype, "isUsernameExist", null);
exports.UserController = UserController = __decorate([
    (0, common_1.Controller)(),
    __metadata("design:paramtypes", [typeof (_a = typeof user_service_1.UserService !== "undefined" && user_service_1.UserService) === "function" ? _a : Object, typeof (_b = typeof shared_1.SharedService !== "undefined" && shared_1.SharedService) === "function" ? _b : Object])
], UserController);


/***/ }),

/***/ "./apps/user/src/user.module.ts":
/*!**************************************!*\
  !*** ./apps/user/src/user.module.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserModule = void 0;
const common_1 = __webpack_require__(/*! @nestjs/common */ "@nestjs/common");
const user_controller_1 = __webpack_require__(/*! ./user.controller */ "./apps/user/src/user.controller.ts");
const user_service_1 = __webpack_require__(/*! ./user.service */ "./apps/user/src/user.service.ts");
const config_1 = __webpack_require__(/*! @nestjs/config */ "@nestjs/config");
const mongoose_1 = __webpack_require__(/*! @nestjs/mongoose */ "@nestjs/mongoose");
const microservices_1 = __webpack_require__(/*! @nestjs/microservices */ "@nestjs/microservices");
const profile_schema_1 = __webpack_require__(/*! ./schemas/profile.schema */ "./apps/user/src/schemas/profile.schema.ts");
const user_schema_1 = __webpack_require__(/*! ./schemas/user.schema */ "./apps/user/src/schemas/user.schema.ts");
const shared_1 = __webpack_require__(/*! @app/shared */ "./libs/shared/src/index.ts");
const zodiac_schema_1 = __webpack_require__(/*! ./schemas/zodiac.schema */ "./apps/user/src/schemas/zodiac.schema.ts");
let UserModule = class UserModule {
};
exports.UserModule = UserModule;
exports.UserModule = UserModule = __decorate([
    (0, common_1.Module)({
        imports: [
            config_1.ConfigModule.forRoot({
                isGlobal: true,
                envFilePath: '.env',
            }),
            mongoose_1.MongooseModule.forRootAsync({
                imports: [config_1.ConfigModule],
                useFactory: async (configService) => ({
                    uri: configService.get('MONGODB_URI'),
                }),
                inject: [config_1.ConfigService],
            }),
            mongoose_1.MongooseModule.forFeature([{ name: 'User', schema: user_schema_1.UserSchema }]),
            mongoose_1.MongooseModule.forFeature([{ name: 'Profile', schema: profile_schema_1.ProfileSchema }]),
            mongoose_1.MongooseModule.forFeature([{ name: 'ZodiacEnd', schema: zodiac_schema_1.ZodiacEnd }]),
            shared_1.SharedModule,
        ],
        controllers: [user_controller_1.UserController],
        providers: [
            user_service_1.UserService,
            {
                provide: 'USER_SERVICE',
                useFactory: (configService) => {
                    const USER = configService.get('RABBITMQ_USER');
                    const PASSWORD = configService.get('RABBITMQ_PASS');
                    const HOST = configService.get('RABBITMQ_HOST');
                    const QUEUE = configService.get('RABBITMQ_USER_QUEUE');
                    return microservices_1.ClientProxyFactory.create({
                        transport: microservices_1.Transport.RMQ,
                        options: {
                            urls: [`amqp://${USER}:${PASSWORD}@${HOST}`],
                            queue: QUEUE,
                            queueOptions: {
                                durable: true,
                            },
                        },
                    });
                },
                inject: [config_1.ConfigService],
            },
            {
                provide: 'AUTH_SERVICE',
                useFactory: (configService) => {
                    const USER = configService.get('RABBITMQ_USER');
                    const PASSWORD = configService.get('RABBITMQ_PASS');
                    const HOST = configService.get('RABBITMQ_HOST');
                    const QUEUE = configService.get('RABBITMQ_AUTH_QUEUE');
                    return microservices_1.ClientProxyFactory.create({
                        transport: microservices_1.Transport.RMQ,
                        options: {
                            urls: [`amqp://${USER}:${PASSWORD}@${HOST}`],
                            queue: QUEUE,
                            queueOptions: {
                                durable: true,
                            },
                        },
                    });
                },
                inject: [config_1.ConfigService],
            },
        ],
    })
], UserModule);


/***/ }),

/***/ "./apps/user/src/user.service.ts":
/*!***************************************!*\
  !*** ./apps/user/src/user.service.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.UserService = void 0;
const common_1 = __webpack_require__(/*! @nestjs/common */ "@nestjs/common");
const mongoose_1 = __webpack_require__(/*! @nestjs/mongoose */ "@nestjs/mongoose");
const mongoose_2 = __webpack_require__(/*! mongoose */ "mongoose");
const horoscope_enum_1 = __webpack_require__(/*! ./enums/horoscope.enum */ "./apps/user/src/enums/horoscope.enum.ts");
const zodiac_enum_1 = __webpack_require__(/*! ./enums/zodiac.enum */ "./apps/user/src/enums/zodiac.enum.ts");
const zodiac_end_init_constant_1 = __webpack_require__(/*! ./constants/zodiac-end-init.constant */ "./apps/user/src/constants/zodiac-end-init.constant.ts");
const microservices_1 = __webpack_require__(/*! @nestjs/microservices */ "@nestjs/microservices");
const rxjs_1 = __webpack_require__(/*! rxjs */ "rxjs");
let UserService = class UserService {
    constructor(userModel, profileModel, zodiacEndModel, authService) {
        this.userModel = userModel;
        this.profileModel = profileModel;
        this.zodiacEndModel = zodiacEndModel;
        this.authService = authService;
    }
    async create(createUserDto) {
        const createdUser = new this.userModel(createUserDto);
        createdUser.password = await (0, rxjs_1.firstValueFrom)(this.authService.send('hash-password', createUserDto.password));
        const result = await createdUser.save();
        this.createProfile(result._id.toString(), {});
        return result._id.toString();
    }
    async createProfile(userId, createProfileDto) {
        const profile = {
            userId,
            ...createProfileDto,
        };
        const createdProfile = new this.profileModel(profile);
        const result = await createdProfile.save();
        return result !== null;
    }
    async getProfileNames(ids) {
        return (await this.profileModel.find({ _id: { $in: ids } }).exec()).map((profile) => {
            return {
                id: profile._id.toString(),
                name: profile.name,
            };
        });
    }
    async findOneByEmailOrByUsername(emailOrUsername) {
        return this.userModel
            .findOne({
            $or: [
                { email: emailOrUsername.email },
                { username: emailOrUsername.username },
            ],
        })
            .exec();
    }
    async findOneByEmail(email) {
        return this.userModel.findOne({ email }).exec();
    }
    async findOneByUsername(username) {
        return this.userModel.findOne({ username }).exec();
    }
    async findOneById(id) {
        return this.userModel.findById(id).exec();
    }
    async findAllProfile(userId) {
        const profile = await this.profileModel.findOne({ userId }).exec();
        if (!profile)
            return [];
        const profiles = await this.profileModel
            .find({ _id: { $ne: profile._id } })
            .exec();
        return profiles;
    }
    async getProfileAndUser(userId) {
        const [profile, user] = await Promise.all([
            this.profileModel.findOne({ userId }).exec(),
            this.userModel.findById(userId).exec(),
        ]);
        if (profile == null || user == null)
            return { profile: null, user: null };
        return { profile, user };
    }
    async updatePassword(data) {
        const result = await this.userModel.updateOne({ _id: data.userId }, { password: data.password });
        if (result.acknowledged === false)
            return false;
        return result.modifiedCount === 1;
    }
    async isUserIdExist(userId) {
        const result = await this.userModel.findById(userId).exec();
        return result !== null;
    }
    async getHoroscope(dob) {
        const [year, month, day] = dob.split('-').map(Number);
        const isLeapYear = year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);
        const adjustedDay = month * 100 + day + (isLeapYear && month > 2 ? 1 : 0);
        const startDates = Object.keys(horoscope_enum_1.HOROSCOPE_START_DATES);
        for (let i = 0; i < startDates.length; i++) {
            const startDate = startDates[i];
            if (adjustedDay >= parseInt(startDate) &&
                adjustedDay < parseInt(startDates[i + 1])) {
                return horoscope_enum_1.HOROSCOPE_START_DATES[startDate];
            }
        }
        return horoscope_enum_1.HOROSCOPE.Capricorn;
    }
    async getZodiac(data) {
        const dob = new Date(data);
        const startDate = new Date('1912-02-18');
        let dbList = await this.zodiacEndModel.find();
        if (dbList.length === 0) {
            const zodiacEnd = new this.zodiacEndModel({ data: zodiac_end_init_constant_1.zodiacEndList });
            await zodiacEnd.save();
        }
        dbList = await this.zodiacEndModel.find();
        const endDateList = dbList[0].data;
        let deltaYear = dob.getFullYear() - startDate.getFullYear();
        const endDate = new Date(endDateList[endDateList.length - deltaYear]);
        const offset = dob.getTime() < endDate.getTime() ? 0 : 1;
        deltaYear += offset;
        const zodiacIndex = deltaYear % 12;
        const result = zodiac_enum_1.zodiacList.at(zodiacIndex);
        if (!result)
            return '';
        return result;
    }
    async getHoroscopeZodiac(birthday) {
        const [horoscope, zodiac] = await Promise.all([
            this.getHoroscope(birthday),
            this.getZodiac(birthday),
        ]);
        if (!horoscope || !zodiac)
            return null;
        return { horoscope, zodiac };
    }
    async updateProfile(userId, updateProfileDto) {
        const result = await this.profileModel.updateOne({ userId: String(userId) }, updateProfileDto);
        if (result.acknowledged === false)
            return false;
        return result.modifiedCount === 1;
    }
    async isUsernameExist(username) {
        const result = await this.userModel.findOne({ username }).exec();
        return result !== null;
    }
};
exports.UserService = UserService;
exports.UserService = UserService = __decorate([
    (0, common_1.Injectable)(),
    __param(0, (0, mongoose_1.InjectModel)('User')),
    __param(1, (0, mongoose_1.InjectModel)('Profile')),
    __param(2, (0, mongoose_1.InjectModel)('ZodiacEnd')),
    __param(3, (0, common_1.Inject)('AUTH_SERVICE')),
    __metadata("design:paramtypes", [typeof (_a = typeof mongoose_2.Model !== "undefined" && mongoose_2.Model) === "function" ? _a : Object, typeof (_b = typeof mongoose_2.Model !== "undefined" && mongoose_2.Model) === "function" ? _b : Object, typeof (_c = typeof mongoose_2.Model !== "undefined" && mongoose_2.Model) === "function" ? _c : Object, typeof (_d = typeof microservices_1.ClientProxy !== "undefined" && microservices_1.ClientProxy) === "function" ? _d : Object])
], UserService);


/***/ }),

/***/ "./libs/shared/src/index.ts":
/*!**********************************!*\
  !*** ./libs/shared/src/index.ts ***!
  \**********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __exportStar = (this && this.__exportStar) || function(m, exports) {
    for (var p in m) if (p !== "default" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
__exportStar(__webpack_require__(/*! ./shared.module */ "./libs/shared/src/shared.module.ts"), exports);
__exportStar(__webpack_require__(/*! ./shared.service */ "./libs/shared/src/shared.service.ts"), exports);


/***/ }),

/***/ "./libs/shared/src/interfaces/rmq-data.interface.ts":
/*!**********************************************************!*\
  !*** ./libs/shared/src/interfaces/rmq-data.interface.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.RmqData = void 0;
class RmqData {
    constructor(channel, message, event) {
        this.channel = channel;
        this.message = message;
        this.event = event;
    }
    nack() {
        this.channel.nack(this.message);
    }
    ack() {
        this.channel.ack(this.message);
    }
    get data() {
        return this.event.data;
    }
}
exports.RmqData = RmqData;


/***/ }),

/***/ "./libs/shared/src/shared.module.ts":
/*!******************************************!*\
  !*** ./libs/shared/src/shared.module.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SharedModule = void 0;
const common_1 = __webpack_require__(/*! @nestjs/common */ "@nestjs/common");
const shared_service_1 = __webpack_require__(/*! ./shared.service */ "./libs/shared/src/shared.service.ts");
let SharedModule = class SharedModule {
};
exports.SharedModule = SharedModule;
exports.SharedModule = SharedModule = __decorate([
    (0, common_1.Module)({
        providers: [shared_service_1.SharedService],
        exports: [shared_service_1.SharedService],
    })
], SharedModule);


/***/ }),

/***/ "./libs/shared/src/shared.service.ts":
/*!*******************************************!*\
  !*** ./libs/shared/src/shared.service.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SharedService = void 0;
const common_1 = __webpack_require__(/*! @nestjs/common */ "@nestjs/common");
const rmq_data_interface_1 = __webpack_require__(/*! ./interfaces/rmq-data.interface */ "./libs/shared/src/interfaces/rmq-data.interface.ts");
let SharedService = class SharedService {
    extractData(context) {
        const channel = context.getChannelRef();
        const message = context.getMessage();
        const event = JSON.parse(message.content.toString());
        return new rmq_data_interface_1.RmqData(channel, message, event);
    }
};
exports.SharedService = SharedService;
exports.SharedService = SharedService = __decorate([
    (0, common_1.Injectable)()
], SharedService);


/***/ }),

/***/ "@nestjs/common":
/*!*********************************!*\
  !*** external "@nestjs/common" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@nestjs/common");

/***/ }),

/***/ "@nestjs/config":
/*!*********************************!*\
  !*** external "@nestjs/config" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@nestjs/config");

/***/ }),

/***/ "@nestjs/core":
/*!*******************************!*\
  !*** external "@nestjs/core" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("@nestjs/core");

/***/ }),

/***/ "@nestjs/microservices":
/*!****************************************!*\
  !*** external "@nestjs/microservices" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@nestjs/microservices");

/***/ }),

/***/ "@nestjs/mongoose":
/*!***********************************!*\
  !*** external "@nestjs/mongoose" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("@nestjs/mongoose");

/***/ }),

/***/ "mongoose":
/*!***************************!*\
  !*** external "mongoose" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("mongoose");

/***/ }),

/***/ "rxjs":
/*!***********************!*\
  !*** external "rxjs" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("rxjs");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
var exports = __webpack_exports__;
/*!*******************************!*\
  !*** ./apps/user/src/main.ts ***!
  \*******************************/

Object.defineProperty(exports, "__esModule", ({ value: true }));
const core_1 = __webpack_require__(/*! @nestjs/core */ "@nestjs/core");
const user_module_1 = __webpack_require__(/*! ./user.module */ "./apps/user/src/user.module.ts");
const config_1 = __webpack_require__(/*! @nestjs/config */ "@nestjs/config");
const microservices_1 = __webpack_require__(/*! @nestjs/microservices */ "@nestjs/microservices");
async function bootstrap() {
    const app = await core_1.NestFactory.create(user_module_1.UserModule);
    const configService = app.get(config_1.ConfigService);
    const USER = configService.get('RABBITMQ_USER');
    const PASSWORD = configService.get('RABBITMQ_PASS');
    const HOST = configService.get('RABBITMQ_HOST');
    const QUEUE = configService.get('RABBITMQ_USER_QUEUE');
    app.connectMicroservice({
        transport: microservices_1.Transport.RMQ,
        options: {
            urls: [`amqp://${USER}:${PASSWORD}@${HOST}`],
            noAck: false,
            queue: QUEUE,
            queueOptions: {
                durable: true,
            },
        },
    });
    app.startAllMicroservices();
}
bootstrap();

})();

/******/ })()
;